graph TD
    subgraph "ThreadLocalLogTrace의 핵심 메커니즘"
        TLT[ThreadLocalLogTrace]
        TL["ThreadLocal&lt;TraceId&gt;<br>traceIdHolder"]
        T1[Thread 1<br>TraceId 저장소]
        T2[Thread 2<br>TraceId 저장소]
        
        TLT -->|"사용"| TL
        TL -->|"참조"| T1
        TL -->|"참조"| T2
        
        subgraph "동작 원리"
            B1["1. begin(message)"]
            S1["2. syncTraceId()"]
            S2["3. TraceId 레벨 관리<br>(생성/증가)"]
            E1["4. end(status)"]
            R1["5. releaseTraceId()"]
            R2["6. TraceId 레벨 감소<br>또는 제거"]
        end
        
        B1 --> S1
        S1 --> S2
        E1 --> R1
        R1 --> R2
        
        subgraph "계층적 로그 특징"
            ID["트랜잭션 ID 유지"]
            LV["메서드 호출 깊이에 따른<br>레벨 자동 증감"]
            VS["시각적 들여쓰기로<br>호출 관계 표현"]
            AC["자동 정리 기능<br>(최상위 레벨에서만 remove)"]
        end
    end
    
    style TLT fill:#f9f,stroke:#333,stroke-width:2px
    style TL fill:#bbf,stroke:#333,stroke-width:1px
    style T1 fill:#bfb,stroke:#333,stroke-width:1px
    style T2 fill:#bfb,stroke:#333,stroke-width:1px